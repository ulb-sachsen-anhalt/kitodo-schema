# -*- mode: rnc; -*-
#
# RelaxNG Schema für Kitido.Production Importkonfiguration
#

# Author: David Maus <maus@hab.de>, Christian Schmiljun <christian.schmiljun@bibliothek.uni-halle.de>
#

namespace s = "http://purl.oclc.org/dsdl/schematron"
namespace xsi = "http://www.w3.org/2001/XMLSchema-instance" 

start = opacCatalogues

opacCatalogues =
   element opacCatalogues {
      attribute xsi:noNamespaceSchemaLocation { text }?
    & doctypes
    & catalogue+
   }

doctypes =
   element doctypes {
      type+
   }

catalogue =
   element catalogue {
      attribute title { text }
    & config
    & searchFields
    & resolve*
    & beautify?
   }

config =
   element config {
      attribute scheme { "http" | "https" }?
    & attribute address { text }
    & attribute database { text }
    & attribute description { text }
    & attribute port { xsd:integer }
    & attribute ucnf { text }?
    & empty
   }

searchFields =
   element searchFields {
      searchField+
   }

searchField =
   element searchField {
      attribute label { text }
    & attribute value { xsd:integer }
   }

resolve =
   element resolve {
      attribute tag { text }
    & attribute subtag { text }
    & map+
   }

map =
   element map {
      attribute tag { text },
      attribute subtag { text },
      attribute asSubtag { text }
   }
   
beautify = 
    element beautify {
        setvalue*
    }
    
setvalue = 
    element setvalue {
        attribute tag { text },
        attribute subtag { text },
        attribute value { text },
        attribute mode { "append" | "replace" | "prepend"},
        attribute modeextended { "occurence" }?, # ULB spezifische Erweiterung - Zum erweiterten Umgang mit Signaturen notwendig 
        condition+
    }

condition = 
    element condition {
        attribute tag { text },
        attribute subtag { text },
        attribute value { text },
        attribute mode { "matches" | "find" },        
        attribute primaryOutput { xsd:boolean }?  # ULB spezifische Erweiterung - Markiert den Matcher dieser Kondition als primären Ausgabematcher
    }

type =
   element type {
      attribute isContainedWork { xsd:boolean }
    & attribute isMultiVolume { xsd:boolean }
    & attribute isPeriodical { xsd:boolean }
    & attribute isNewspaper { xsd:boolean }
    & attribute rulesetType { xsd:NMTOKEN }
    & attribute tifHeaderType { text }
    & attribute title { text } # Der Wert des Attributs wird als Wert (@value) für den DocType im Formular der Vorgangsdaten verwendet.
    & label*
    & mapping+
   }

label =
   element label {
      attribute language { xsd:language },
      text
   }

mapping =
   element mapping {
      text
   }